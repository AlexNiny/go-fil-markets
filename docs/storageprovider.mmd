stateDiagram-v2
	state "StorageDealUnknown" as 0
	state "StorageDealStaged" as 4
	state "StorageDealSealing" as 5
	state "StorageDealActive" as 6
	state "StorageDealRejecting" as 9
	state "StorageDealFailing" as 10
	state "StorageDealValidating" as 14
	state "StorageDealAcceptWait" as 15
	state "StorageDealTransferring" as 17
	state "StorageDealWaitingForData" as 18
	state "StorageDealVerifyData" as 19
	state "StorageDealEnsureProviderFunds" as 20
	state "StorageDealProviderFunding" as 22
	state "StorageDealPublish" as 24
	state "StorageDealPublishing" as 25
	state "StorageDealError" as 26
	state "StorageDealCompleted" as 27
	4 : On entry runs HandoffDeal
	5 : On entry runs VerifyDealActivated
	6 : On entry runs RecordPieceInfo
	9 : On entry runs RejectDeal
	10 : On entry runs FailDeal
	14 : On entry runs ValidateDealProposal
	15 : On entry runs DecideOnProposal
	19 : On entry runs VerifyData
	20 : On entry runs EnsureProviderFunds
	22 : On entry runs WaitForFunding
	24 : On entry runs PublishDeal
	25 : On entry runs WaitForPublish
	[*] --> 0
	note right of 0
		The following events are not shown cause they can trigger from any state.

		ProviderEventNodeErrored - transitions state to StorageDealFailing
		ProviderEventRestart - does not transition state
	end note
	0 --> 14 : ProviderEventOpen
	14 --> 9 : ProviderEventDealRejected
	15 --> 9 : ProviderEventDealRejected
	19 --> 9 : ProviderEventDealRejected
	9 --> 10 : ProviderEventRejectionSent
	14 --> 15 : ProviderEventDealDeciding
	15 --> 18 : ProviderEventDataRequested
	17 --> 10 : ProviderEventDataTransferFailed
	18 --> 17 : ProviderEventDataTransferInitiated
	17 --> 19 : ProviderEventDataTransferCompleted
	19 --> 10 : ProviderEventDataVerificationFailed
	18 --> 20 : ProviderEventVerifiedData
	19 --> 20 : ProviderEventVerifiedData
	20 --> 22 : ProviderEventFundingInitiated
	20 --> 24 : ProviderEventFunded
	22 --> 24 : ProviderEventFunded
	24 --> 25 : ProviderEventDealPublishInitiated
	25 --> 10 : ProviderEventDealPublishError
	9 --> 10 : ProviderEventSendResponseFailed
	15 --> 10 : ProviderEventSendResponseFailed
	25 --> 4 : ProviderEventDealPublished
	4 --> 10 : ProviderEventFileStoreErrored
	5 --> 10 : ProviderEventFileStoreErrored
	6 --> 10 : ProviderEventFileStoreErrored
	4 --> 10 : ProviderEventDealHandoffFailed
	4 --> 5 : ProviderEventDealHandedOff
	5 --> 10 : ProviderEventDealActivationFailed
	5 --> 6 : ProviderEventDealActivated
	6 --> 10 : ProviderEventPieceStoreErrored
	6 --> 27 : ProviderEventDealCompleted
	6 --> 10 : ProviderEventUnableToLocatePiece
	6 --> 10 : ProviderEventReadMetadataErrored
	10 --> 26 : ProviderEventFailed
	26 --> [*]
	27 --> [*]
